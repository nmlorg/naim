LOBJEXT = lo

nodist_pkgdoc_DATA = commands.txt 
pkgdoc_DATA = keyboard.txt

BUILT_SOURCES = \
	commands.txt

DISTCLEANFILES = \
	conio_keys.h \
	conio_cmds.h \
	${BUILT_SOURCES}
	
EXTRA_DIST = \
	${pkgdoc_DATA} \
	cmplhlp2.sh \
	cmplhelp.sh \
	gencmds.sh \
	gencmd2.sh \
	genkeys.sh \
	main_stub.c \
	snapshot.h

bin_PROGRAMS = naim

NAIM_CORE = \
	alias.c \
	atomizer.c \
	buddy.c \
	commands.c \
	conio.c \
	echof.c \
	events.c \
	fireio.c \
	hamster.c \
	help.h \
	help.c \
	helpcmd.c \
	hwprintf.c \
	linux_vsprintf.c \
	main.c \
	naim-int.h \
	rc.c \
	rodents.c \
	set.c \
	win.c

if CYGWIN
NAIM_SOURCES = main_stub.c
NAIM_LDADD = libnaim_core.la

lib_LTLIBRARIES = libnaim_core.la
libnaim_core_la_SOURCES = ${NAIM_CORE}
libnaim_core_la_CFLAGS = ${AM_CFLAGS} -DDLSEARCHPATH='"${pkgmoddir}"'
libnaim_core_la_CPPFLAGS = -DDLSEARCHPATH='"${pkgmoddir}"'
libnaim_core_la_LIBADD = \
	@LIBLTDL@ ../lua/libnlua.la \
	@CURSESLIB@ @NETLIB@
libnaim_core_la_LDFLAGS = -export-dynamic -no-undefined \
	-Wl,--whole-archive -Wl,../libfiretalk/libfiretalk.a -Wl,--no-whole-archive
else
NAIM_SOURCES = ${NAIM_CORE}
NAIM_LDADD = \
	../libfiretalk/libfiretalk.a \
	@LIBLTDL@ \
	../lua/libnlua.la \
	@CURSESLIB@ @NETLIB@
naim_CPPFLAGS = -DDLSEARCHPATH='"${pkgmoddir}"'
endif

naim_SOURCES = ${NAIM_SOURCES}
naim_LDADD = ${NAIM_LDADD}
naim_LDFLAGS = -dlopen self -export-dynamic -no-undefined

INCLUDES = -I${top_srcdir}/include -I${top_srcdir}/libfiretalk ${INCLTDL}

conio_keys.h: ${srcdir}/conio.c config.h
	AWK="${AWK}" CPP="${CPP} ${CPPFLAGS} ${DEFAULT_INCLUDES} ${INCLUDES} ${DEFS}" SRCDIR=${srcdir} ${srcdir}/genkeys.sh > conio_keys.h

conio_cmds.h: ${srcdir}/commands.c config.h
	AWK="${AWK}" CPP="${CPP} ${CPPFLAGS} ${DEFAULT_INCLUDES} ${INCLUDES} ${DEFS}" ${srcdir}/gencmds.sh > conio_cmds.h

commands.txt: ${srcdir}/commands.c config.h
	AWK="${AWK}" CPP="${CPP} ${CPPFLAGS} ${DEFAULT_INCLUDES} ${INCLUDES} ${DEFS}" ${srcdir}/gencmd2.sh > commands.txt

help.h: ${top_srcdir}/doc/naim.hlp
	AWK="${AWK}" "${srcdir}/cmplhlp2.sh" < ${top_srcdir}/doc/naim.hlp > help.h

help.c: ${top_srcdir}/doc/naim.hlp
	AWK="${AWK}" "${srcdir}/cmplhelp.sh" < ${top_srcdir}/doc/naim.hlp > help.c

naim-commands.${OBJEXT}: conio_cmds.h
libnaim_la-commands.${LOBJEXT}: conio_cmds.h
naim-conio.${OBJEXT}: conio_keys.h
libnaim_la-conio.${LOBJEXT}: conio_keys.h
naim-events.${OBJEXT}: conio_cmds.h
libnaim_la-events.${LOBJEXT}: conio_cmds.h
naim-fireio.${OBJEXT}: conio_cmds.h
libnaim_la-fireio.${LOBJEXT}: conio_cmds.h
naim-helpcmd.${OBJEXT}: conio_cmds.h
libnaim_la-helpcmd.${LOBJEXT}: conio_cmds.h

install: install-am install-global-symlink

install-global-symlink:
	mkdir -p $(DESTDIR)$(bindir)
	for proto in irc icq lily; do \
		if [ ! -h $(DESTDIR)$(bindir)/n$${proto} ]; then \
			rm -f $(DESTDIR)$(bindir)/n$${proto}; \
			ln -s naim $(DESTDIR)$(bindir)/n$${proto}; \
		fi; \
	done
